<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIQ-Alg 0CO2: Canlı Veri Paneli</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #073B4C; 
        }
        .font-heading {
            font-family: 'Montserrat', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .kpi-card {
            background: #ffffff;
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .nav-link.active {
            color: #118AB2;
            font-weight: 700;
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #073B4C;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translate(-50%, 20px);
        }
        .message-box.show {
            opacity: 1;
            transform: translate(-50%, 0);
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/95 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#hero" class="flex items-center">
                <img src="logo111.png" alt="BIQ-Alg 0CO2 Proje Logosu" class="h-12 w-auto" onerror="this.onerror=null; this.src='https://placehold.co/150x50/FFFFFF/073B4C?text=BiQ-Alg+0CO2';">
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#problem-solution" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Çözüm</a>
                <a href="#technology" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Teknoloji</a>
                <a href="#live-data" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors active">Canlı Veri</a>
                <a href="#summary-table-section" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Özet</a>
                <a href="#future" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Gelecek</a>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32" style="background: linear-gradient(135deg, #118AB2 0%, #06D6A0 100%);">
            <div class="container mx-auto px-6 text-center text-white">
                <h1 class="text-4xl md:text-6xl font-bold font-heading mb-4 tracking-tight">Afet Sonrası Temiz Nefes: <br> BIQ-Alg 0CO2</h1>
                <p class="text-lg md:text-xl max-w-3xl mx-auto opacity-90">
                    Doğanın en güçlü savaşçıları olan mikroalgler ile afet bölgelerine anında hava kalitesi, sürdürülebilir enerji ve umut taşıyan mobil eğitim istasyonunu keşfedin.
                </p>
            </div>
        </section>

        <section id="live-data" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Canlı Veri İzleme Paneli</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        BIQ-Alg 0CO2 istasyonundan gelen gerçek zamanlı sensör verilerini buradan takip edin. Bu panel, sistemin anlık performansını ve çevre koşullarını gösterir.
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8 text-center">
                    <div class="kpi-card p-4 rounded-lg shadow-md">
                        <h4 class="font-bold text-gray-500 text-sm">CO₂ SEVİYESİ</h4>
                        <p id="kpi-co2" class="text-3xl font-black text-[#118AB2] mt-1">--- <span class="text-lg">ppm</span></p>
                    </div>
                    <div class="kpi-card p-4 rounded-lg shadow-md">
                        <h4 class="font-bold text-gray-500 text-sm">HAVA KALİTESİ</h4>
                        <p id="kpi-mq135" class="text-3xl font-black text-[#06D6A0] mt-1">---</p>
                    </div>
                    <div class="kpi-card p-4 rounded-lg shadow-md">
                        <h4 class="font-bold text-gray-500 text-sm">IŞIK ŞİDDETİ</h4>
                        <p id="kpi-light" class="text-3xl font-black text-[#FFD166] mt-1">--- <span class="text-lg">lux</span></p>
                    </div>
                    <div class="kpi-card p-4 rounded-lg shadow-md">
                        <h4 class="font-bold text-gray-500 text-sm">SICAKLIK</h4>
                        <p id="kpi-temp" class="text-3xl font-black text-[#FF6B6B] mt-1">-- <span class="text-lg">°C</span></p>
                    </div>
                    <div class="kpi-card p-4 rounded-lg shadow-md">
                        <h4 class="font-bold text-gray-500 text-sm">NEM</h4>
                        <p id="kpi-humidity" class="text-3xl font-black text-[#118AB2] mt-1">-- <span class="text-lg">%</span></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold font-heading text-center mb-4 text-[#073B4C]">Sıcaklık ve Nem Trendi (Son 30 Okuma)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="tempHumidityChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold font-heading text-center mb-4 text-[#073B4C]">CO₂ Seviyesi Trendi (Son 30 Okuma)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="co2Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        </main>

    <footer class="bg-[#073B4C] text-white py-8 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 BIQ-Alg 0CO2 Projesi. Tüm Hakları Saklıdır.</p>
            <p class="text-sm opacity-70 mt-2">Daha Yeşil Bir Gelecek İçin Biyoteknoloji.</p>
        </div>
    </footer>
    
    <div id="message-box" class="message-box"></div>

    <script type="module">
        // Gerekli Firebase kütüphanelerini içe aktar
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', function () {
            
            // TAMAMEN DOĞRU VE ÇALIŞAN firebaseConfig
            const firebaseConfig = {
                apiKey: "AIzaSyBvJNWLHjMqlhAdZXSBqHQuPNnnImNZd4Q",
                authDomain: "biqalgco2-hava-istasyonu.firebaseapp.com",
                databaseURL: "https://biqalgco2-hava-istasyonu-default-rtdb.firebaseio.com",
                projectId: "biqalgco2-hava-istasyonu",
                storageBucket: "biqalgco2-hava-istasyonu.appspot.com",
                messagingSenderId: "1014289654311",
                appId: "1:1014289654311:web:e37e2a3ffe78a3cc4ba402"
            };
            
            // Değişkenler
            let db, auth;

            function showMessage(message, duration = 3000) {
                const messageBox = document.getElementById('message-box');
                if (!messageBox) return;
                messageBox.textContent = message;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, duration);
            }

            // Firebase'i başlat
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } catch(e) {
                console.error("Firebase başlatma hatası:", e);
                showMessage("Uygulama başlatılamadı. Lütfen sayfayı yenileyin.");
                return;
            }
            
            // Anonim giriş yap ve veri dinlemeyi başlat
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("Kullanıcı anonim olarak oturum açtı:", user.uid);
                    startRealtimeListeners();
                } else {
                    signInAnonymously(auth).catch((error) => {
                        console.error("Anonim kimlik doğrulama hatası:", error);
                        let userMessage = "Canlı verilere bağlanılamadı.";
                        if (error.code === 'auth/operation-not-allowed') {
                            userMessage = "HATA: Anonim giriş projenizde etkin değil. Lütfen Firebase Console > Authentication > Sign-in method'dan 'Anonim'i etkinleştirin.";
                        }
                        showMessage(
