<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIQ-Alg 0CO2: Hava Kalitesi Paneli</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f8f9fa; color: #073B4C; }
        .font-heading { font-family: 'Montserrat', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 550px; margin: auto; height: 320px; }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        .kpi-card { background: #ffffff; border-radius: 0.75rem; padding: 1rem; text-align: center; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .nav-link.active { color: #118AB2; font-weight: 700; }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/95 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#hero" class="flex items-center">
                <img src="logo111.png" alt="BIQ-Alg 0CO2 Proje Logosu" class="h-12 w-auto" onerror="this.onerror=null; this.src='https://placehold.co/150x50/FFFFFF/073B4C?text=BiQ-Alg+0CO2';">
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#problem-solution" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Ã‡Ã¶zÃ¼m</a>
                <a href="#technology" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Teknoloji</a>
                <a href="#live-data" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">CanlÄ± Veri</a>
                <a href="#city-comparison" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">KarÅŸÄ±laÅŸtÄ±rma</a>
                <a href="#summary-table-section" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Ã–zet</a>
                <a href="#future" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Gelecek</a>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32" style="background: linear-gradient(135deg, #118AB2 0%, #06D6A0 100%);">
            <div class="container mx-auto px-6 text-center text-white">
                <h1 class="text-4xl md:text-6xl font-bold font-heading mb-4 tracking-tight">Afet SonrasÄ± Temiz Nefes: <br> BIQ-Alg 0CO2</h1>
                <p class="text-lg md:text-xl max-w-3xl mx-auto opacity-90">
                    DoÄŸanÄ±n en gÃ¼Ã§lÃ¼ savaÅŸÃ§Ä±larÄ± olan mikroalgler ile afet bÃ¶lgelerine anÄ±nda hava kalitesi, sÃ¼rdÃ¼rÃ¼lebilir enerji ve umut taÅŸÄ±yan mobil eÄŸitim istasyonunu keÅŸfedin.
                </p>
            </div>
        </section>

        <section id="problem-solution" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">GÃ¶rÃ¼nmez Tehlikeye KarÅŸÄ± Biyolojik Kalkan</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Afetler, ardÄ±nda sadece enkaz bÄ±rakmaz; aynÄ± zamanda havayÄ± kirleten tehlikeli partikÃ¼llerle doldurur. Geleneksel Ã§Ã¶zÃ¼mler yetersiz kalÄ±rken, doÄŸa bize Ã§ok daha gÃ¼Ã§lÃ¼ bir alternatif sunuyor.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 items-center text-center">
                    <div class="bg-white p-8 rounded-xl shadow-lg">
                        <h3 class="font-heading text-2xl font-bold text-[#FF6B6B] mb-3">GELENEKSEL YÃ–NTEMLER</h3>
                        <p class="text-gray-600">Enerji yoÄŸun, maliyetli ve sadece partikÃ¼l filtreler. COâ‚‚ yakalama veya Oâ‚‚ Ã¼retme yetenekleri yoktur.</p>
                    </div>
                    <div class="p-8">
                         <div class="text-6xl md:text-8xl font-black text-[#118AB2] font-heading">50x</div>
                         <p class="font-bold text-xl mt-2 text-[#073B4C]">DAHA VERÄ°MLÄ°</p>
                         <p class="text-gray-600 mt-1">Mikroalgler, karasal bitkilere gÃ¶re 10 ila 50 kat daha verimli COâ‚‚ yakalar.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg">
                        <h3 class="font-heading text-2xl font-bold text-[#06D6A0] mb-3">MÄ°KROALG Ã‡Ã–ZÃœMÃœ</h3>
                        <p class="text-gray-600">HavayÄ± temizler, oksijen Ã¼retir ve dÃ¶ngÃ¼sel ekonomi iÃ§in deÄŸerli biyokÃ¼tle oluÅŸturur.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="technology" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Hava ArÄ±tmanÄ±n Kalbi: FotobiyoreaktÃ¶r (FBR) Teknolojileri</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Mikroalglerin gÃ¼cÃ¼nÃ¼ en verimli ÅŸekilde kullanmak iÃ§in farklÄ± reaktÃ¶r tasarÄ±mlarÄ± mevcuttur. Her birinin kendine Ã¶zgÃ¼ avantajlarÄ± ve performans metrikleri bulunur. Projemiz, mobilite ve verimliliÄŸi birleÅŸtiren Dikey TÃ¼bÃ¼ler FBR tasarÄ±mÄ±nÄ± temel alÄ±r.
                    </p>
                </div>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="chart-container">
                        <canvas id="pbrPerformanceChart"></canvas>
                    </div>
                    <div id="pbr-info" class="space-y-4">
                        <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300">
                             <h3 class="text-xl font-bold font-heading mb-2 text-[#118AB2]">Dikey TÃ¼bÃ¼ler FBR (Projemizin SeÃ§imi)</h3>
                            <p class="text-gray-600">Kompakt yapÄ±sÄ±yla mobil uygulamalar iÃ§in idealdir. KontrollÃ¼ ortamÄ± sayesinde yÃ¼ksek verimlilik ve stabilite sunar. Az yer kaplar ve afet bÃ¶lgelerinde hÄ±zla kurulabilir.</p>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 opacity-70">
                             <h3 class="text-xl font-bold font-heading mb-2 text-[#073B4C]">DÃ¼z Panel FBR</h3>
                            <p class="text-gray-600">YÃ¼ksek Ä±ÅŸÄ±k verimliliÄŸi saÄŸlar ancak genellikle daha bÃ¼yÃ¼k ve sabit kurulumlar iÃ§in uygundur.</p>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 opacity-70">
                             <h3 class="text-xl font-bold font-heading mb-2 text-[#073B4C]">AÃ§Ä±k Havuz Sistemleri</h3>
                            <p class="text-gray-600">DÃ¼ÅŸÃ¼k maliyetlidir ancak kirlenme riski yÃ¼ksek ve verimliliÄŸi dÃ¼ÅŸÃ¼ktÃ¼r.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="live-data" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Cihazdan Gelen CanlÄ± Veriler</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        BIQ-Alg 0CO2 istasyonundan gelen gerÃ§ek zamanlÄ± sensÃ¶r verilerini buradan takip edin.
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8 text-center">
                    <div class="kpi-card p-4"><h4 class="font-bold text-gray-500 text-sm">COâ‚‚ SEVÄ°YESÄ°</h4><p id="kpi-co2" class="text-3xl font-black text-[#118AB2] mt-1">--- <span class="text-lg">ppm</span></p></div>
                    <div class="kpi-card p-4"><h4 class="font-bold text-gray-500 text-sm">HAVA KALÄ°TESÄ°</h4><p id="kpi-mq135" class="text-3xl font-black text-[#06D6A0] mt-1">---</p></div>
                    <div class="kpi-card p-4"><h4 class="font-bold text-gray-500 text-sm">IÅIK ÅÄ°DDETÄ°</h4><p id="kpi-light" class="text-3xl font-black text-[#FFD166] mt-1">--- <span class="text-lg">lux</span></p></div>
                    <div class="kpi-card p-4"><h4 class="font-bold text-gray-500 text-sm">SICAKLIK</h4><p id="kpi-temp" class="text-3xl font-black text-[#FF6B6B] mt-1">-- <span class="text-lg">Â°C</span></p></div>
                    <div class="kpi-card p-4"><h4 class="font-bold text-gray-500 text-sm">NEM</h4><p id="kpi-humidity" class="text-3xl font-black text-[#118AB2] mt-1">-- <span class="text-lg">%</span></p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-bold font-heading text-center mb-4 text-[#073B4C]">SÄ±caklÄ±k ve Nem Trendi (Son 10 Okuma)</h3><div class="chart-container" style="height: 300px;"><canvas id="tempHumidityChart"></canvas></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-bold font-heading text-center mb-4 text-[#073B4C]">COâ‚‚ Seviyesi Trendi (Son 10 Okuma)</h3><div class="chart-container" style="height: 300px;"><canvas id="co2Chart"></canvas></div></div>
                </div>
            </div>
        </section>
        
        <section id="city-comparison" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Deprem BÃ¶lgeleri Hava Kalitesi KarÅŸÄ±laÅŸtÄ±rmasÄ±</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        CihazÄ±nÄ±zÄ±n Ã¶lÃ§tÃ¼ÄŸÃ¼ anlÄ±k deÄŸerleri, TÃ¼rkiye'nin farklÄ± illerindeki genel hava kalitesi indeksi (HKÄ°) ile karÅŸÄ±laÅŸtÄ±rÄ±n.
                    </p>
                </div>
                <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
                    <table class="w-full text-left">
                        <thead class="bg-[#073B4C] text-white">
                            <tr>
                                <th class="p-4 font-bold uppercase tracking-wider">Åehir</th>
                                <th class="p-4 font-bold uppercase tracking-wider">Hava Kalite Ä°ndeksi (HKÄ°)</th>
                                <th class="p-4 font-bold uppercase tracking-wider">Durum</th>
                                <th class="p-4 font-bold uppercase tracking-wider">Ana Kirletici</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-table-body" class="divide-y divide-gray-200">
                            <tr><td colspan="4" class="p-8 text-center text-gray-500">Åehir verileri yÃ¼kleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-center text-xs text-gray-500 mt-4">Hava kalitesi verileri <a href="https://aqicn.org/" target="_blank" class="underline hover:text-[#118AB2]">World Air Quality Index Project</a> tarafÄ±ndan saÄŸlanmaktadÄ±r.</p>
            </div>
        </section>

        <section id="summary-table-section" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Projenin Ã–ne Ã‡Ä±kan YÃ¶nleri</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        AÅŸaÄŸÄ±daki tablo, projemizin temel yeteneklerini ve topluma saÄŸladÄ±ÄŸÄ± Ã§ok yÃ¶nlÃ¼ faydalarÄ± Ã¶zetlemektedir.
                    </p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left rounded-lg shadow-lg overflow-hidden">
                        <thead class="bg-[#118AB2] text-white">
                            <tr>
                                <th class="p-4 font-bold uppercase tracking-wider w-1/3">Ã–zellik / Alan</th>
                                <th class="p-4 font-bold uppercase tracking-wider">AÃ§Ä±klama ve Hedef</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-white">
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 font-semibold text-[#073B4C]">Problem OdaklÄ± GeliÅŸtirme</td>
                                <!-- DEÄÄ°ÅÄ°KLÄ°K: Kaynak bilgisi eklendi -->
                                <td class="p-4 text-gray-700">TÃ¼rkiye'de yaÅŸanÄ±lan 6 Åubat deprem felaketindeki atmosfer verileri toplanmÄ±ÅŸ ve sistemin geliÅŸtirilmesinde bu verilerden yararlanÄ±lmÄ±ÅŸtÄ±r. (Kaynak: MGM, Akademik YayÄ±nlar).</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 font-semibold text-[#073B4C]">Mobilite ve AnlÄ±k Analiz</td>
                                <td class="p-4 text-gray-700">Ä°stasyon mobil bir yapÄ±dadÄ±r. GeliÅŸtirilen sistem, afet bÃ¶lgesindeki atmosfer verilerini (COâ‚‚, PM2.5 vb.) anlÄ±k olarak analiz eder, bÃ¶lgedeki hava kalitesi hakkÄ±nda bilgi verir ve bu verileri kayÄ±t altÄ±na alÄ±r.</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 font-semibold text-[#073B4C]">Ã‡ok YÃ¶nlÃ¼ Fayda</td>
                                <td class="p-4 text-gray-700">Sistem; afetzedeler iÃ§in deneyimsel Ã¶ÄŸrenme ortamÄ± oluÅŸturur, hava kalitesini iyileÅŸtirir, Ã¼rettiÄŸi biyokÃ¼tle ile dÃ¶ngÃ¼sel ekonomiye katkÄ±da bulunur ve Ã¼rettiÄŸi oksijen ile daha saÄŸlÄ±klÄ± bir yaÅŸam ortamÄ± saÄŸlar.</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 font-semibold text-[#073B4C]">Ã‡ift AmaÃ§lÄ± YapÄ±</td>
                                <td class="p-4 text-gray-700">Projemiz, hem afet bÃ¶lgesindeki hava kalitesini etkili bir ÅŸekilde iyileÅŸtirmekte hem de interaktif bir STEM eÄŸitim istasyonu olarak gÃ¶rev gÃ¶rmektedir.</td>
                            </tr>
                             <tr class="hover:bg-gray-50">
                                <td class="p-4 font-semibold text-[#073B4C]">CanlÄ± Veri Ä°zleme</td>
                                <td class="p-4 text-gray-700">COâ‚‚, Hava Kalitesi, IÅŸÄ±k, SÄ±caklÄ±k ve Nem gibi kritik parametreler anlÄ±k olarak izlenir ve web arayÃ¼zÃ¼nden takip edilebilir.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <section id="future" class="py-16 md:py-24">
             <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Gelecek Vizyonumuz</h2>
                     <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Bu proje, daha yeÅŸil ve saÄŸlÄ±klÄ± bir gelecek iÃ§in sadece bir baÅŸlangÄ±Ã§.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">âš™ï¸</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#118AB2]">Teknoloji GeliÅŸtirme</h3>
                        <p class="text-gray-600">Daha verimli ve dayanÄ±klÄ± alg tÃ¼rleri araÅŸtÄ±rmak, FBR tasarÄ±mlarÄ±nÄ± optimize etmek ve maliyetleri dÃ¼ÅŸÃ¼rmek.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">ğŸŒ</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#06D6A0]">YaygÄ±nlaÅŸtÄ±rma</h3>
                        <p class="text-gray-600">Mobil Ã¼niteleri farklÄ± afet senaryolarÄ±nda test ederek kentsel alanlara ve okullara entegre etmek.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">ğŸ¤</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#FFD166]">Ekonomik Model</h3>
                        <p class="text-gray-600">BiyokÃ¼tle yan Ã¼rÃ¼nleri iÃ§in pazar oluÅŸturmak ve karbon kredisi gibi finansman modelleri geliÅŸtirmek.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-[#073B4C] text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 BIQ-Alg 0CO2 Projesi. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.</p>
        </div>
    </footer>
    
    <div id="message-box" class="message-box"></div>

    <script type="module">
        // Firebase kÃ¼tÃ¼phanelerini iÃ§e aktar
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', function () {
            
            // --- AYARLAR ---
            const AQI_API_TOKEN = "08039ad9c3603305b99fc2bcaf155da6e0bfdc31"; 
            // DEÄÄ°ÅÄ°KLÄ°K: Åehir listesi gÃ¼ncellendi
            const CITIES = ["Hatay", "Van", "KahramanmaraÅŸ", "Istanbul"];
            const firebaseConfig = {
                apiKey: "AIzaSyBvJNWLHjMqlhAdZXSBqHQuPNnnImNZd4Q",
                authDomain: "biqalgco2-hava-istasyonu.firebaseapp.com",
                databaseURL: "https://biqalgco2-hava-istasyonu-default-rtdb.firebaseio.com",
                projectId: "biqalgco2-hava-istasyonu",
                storageBucket: "biqalgco2-hava-istasyonu.appspot.com",
                messagingSenderId: "1014289654311",
                appId: "1:1014289654311:web:e37e2a3ffe78a3cc4ba402"
            };
            
            // --- UYGULAMA BAÅLATMA ---
            let db;
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        startRealtimeListeners();
                        loadCityComparisons(); 
                    } else {
                        signInAnonymously(auth);
                    }
                });
            } catch(e) { console.error("Firebase baÅŸlatma hatasÄ±:", e); }
            
            // --- ÅEHÄ°R HAVA KALÄ°TESÄ° FONKSÄ°YONLARI ---
            function getAqiStatus(aqi) {
                if (aqi <= 50) return { text: 'Ä°yi', color: 'bg-green-500' };
                if (aqi <= 100) return { text: 'Orta', color: 'bg-yellow-500' };
                if (aqi <= 150) return { text: 'Hassas', color: 'bg-orange-500' };
                if (aqi <= 200) return { text: 'SaÄŸlÄ±ksÄ±z', color: 'bg-red-500' };
                if (aqi <= 300) return { text: 'Ã‡ok SaÄŸlÄ±ksÄ±z', color: 'bg-purple-700' };
                return { text: 'Tehlikeli', color: 'bg-red-900' };
            }

            async function fetchAirQualityData(city) {
                try {
                    const response = await fetch(`https://api.waqi.info/feed/${city}/?token=${AQI_API_TOKEN}`);
                    if (!response.ok) return null;
                    const jsonResponse = await response.json();
                    return jsonResponse.data;
                } catch (error) {
                    console.error(`Hata (${city}):`, error);
                    return null;
                }
            }

            async function loadCityComparisons() {
                const tableBody = document.getElementById('comparison-table-body');
                if (AQI_API_TOKEN === "BURAYA_KENDÄ°_API_ANAHTARINIZI_YAPIÅTIRIN") {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="p-8 text-center text-red-600 font-semibold">
                                LÃ¼tfen Hava Kalitesi KarÅŸÄ±laÅŸtÄ±rmasÄ±nÄ± etkinleÅŸtirmek iÃ§in kodun iÃ§ine API anahtarÄ±nÄ±zÄ± girin.
                                <br>
                                <a href="https://aqicn.org/data-platform/token/" target="_blank" class="text-blue-500 underline mt-2 inline-block">Buradan Ã¼cretsiz anahtar alabilirsiniz.</a>
                            </td>
                        </tr>`;
                    return;
                }
                tableBody.innerHTML = ''; 
                for (const city of CITIES) {
                    const data = await fetchAirQualityData(city);
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    let rowContent = `<td class="p-4 font-semibold text-[#073B4C]">${city}</td>`;
                    if (data && data.aqi) {
                        const status = getAqiStatus(data.aqi);
                        rowContent += `<td class="p-4 font-bold text-lg">${data.aqi}</td>
                                       <td class="p-4"><span class="px-3 py-1 text-sm text-white rounded-full ${status.color}">${status.text}</span></td>
                                       <td class="p-4 text-gray-700 uppercase">${data.dominentpol || '-'}</td>`;
                    } else {
                        rowContent += `<td colspan="3" class="p-4 text-red-500">Veri alÄ±namadÄ± veya istasyon Ã§evrimdÄ±ÅŸÄ±.</td>`;
                    }
                    row.innerHTML = rowContent;
                    tableBody.appendChild(row);
                }
            }

            // --- CANLI VERÄ° VE GRAFÄ°K FONKSÄ°YONLARI ---
            const createChart = (ctx, datasets) => new Chart(ctx, { type: 'line', data: { labels: [], datasets: datasets }, options: { animation: false, responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'second', displayFormats: { second: 'HH:mm:ss' } }, ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 10 }}, y: { beginAtZero: false } }, plugins: { legend: { display: true } } } });
            const tempHumidityChart = createChart(document.getElementById('tempHumidityChart')?.getContext('2d'), [{ label: 'SÄ±caklÄ±k (Â°C)', data: [], borderColor: '#FF6B6B', tension: 0.2 }, { label: 'Nem (%)', data: [], borderColor: '#118AB2', tension: 0.2 }]);
            const co2Chart = createChart(document.getElementById('co2Chart')?.getContext('2d'), [{ label: 'COâ‚‚ (ppm)', data: [], borderColor: '#06D6A0', tension: 0.2, fill: { target: 'origin', above: 'rgba(6, 214, 160, 0.1)'} }]);

            function updateAllCharts(historyData) {
                const labels = [], tempData = [], humData = [], co2Data = [];
                historyData.forEach(dp => {
                    if (dp.timestamp) {
                        labels.push(dp.timestamp.toDate());
                        tempData.push(dp.temperature);
                        humData.push(dp.humidity);
                        co2Data.push(dp.co2);
                    }
                });
                tempHumidityChart.data.labels = labels; tempHumidityChart.data.datasets[0].data = tempData; tempHumidityChart.data.datasets[1].data = humData; tempHumidityChart.update();
                co2Chart.data.labels = labels; co2Chart.data.datasets[0].data = co2Data; co2Chart.update();
            }

            function startRealtimeListeners() {
                const liveDataRef = doc(db, "artifacts/default-app-id/public/data/sensors/current_data");
                onSnapshot(liveDataRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        document.getElementById('kpi-co2').innerHTML = `${data.co2 || '---'} <span class="text-lg">ppm</span>`;
                        document.getElementById('kpi-mq135').textContent = data.mq135_value ? (parseInt(data.mq135_value) < 300 ? 'Ä°yi' : 'Kontrol') : '---';
                        document.getElementById('kpi-light').innerHTML = `${data.light_value || '---'} <span class="text-lg">lux</span>`;
                        document.getElementById('kpi-temp').innerHTML = `${parseFloat(data.temperature || 0).toFixed(1)} <span class="text-lg">Â°C</span>`;
                        document.getElementById('kpi-humidity').innerHTML = `${parseFloat(data.humidity || 0).toFixed(1)} <span class="text-lg">%</span>`;
                    }
                });
                const historyQuery = query(collection(db, "artifacts/default-app-id/public/data/sensor_history"), orderBy("timestamp", "desc"), limit(10));
                onSnapshot(historyQuery, (querySnapshot) => {
                    const historyData = querySnapshot.docs.map(doc => doc.data());
                    updateAllCharts(historyData.reverse());
                });
            }

            // Sayfa kaydÄ±rma ile menÃ¼ aktifliÄŸini saÄŸlayan kodlar
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');
            window.addEventListener('scroll', () => { 
                let current = "hero"; 
                sections.forEach(section => { 
                    const sectionTop = section.offsetTop; 
                    if (window.pageYOffset >= sectionTop - 75) { 
                        current = section.getAttribute('id'); 
                    } 
                }); 
                navLinks.forEach(link => { 
                    link.classList.remove('active'); 
                    if (link.href && link.href.includes(current)) { 
                        link.classList.add('active'); 
                    } 
                }); 
            });

            // STATÄ°K GRAFÄ°K VERÄ°LERÄ° (TECHNOLOGY BÃ–LÃœMÃœ Ä°Ã‡Ä°N)
            const pbrPerformanceChartCtx = document.getElementById('pbrPerformanceChart')?.getContext('2d');
            if(pbrPerformanceChartCtx) {
                new Chart(pbrPerformanceChartCtx, { type: 'bar', data: { labels: ['BiyokÃ¼tle VerimliliÄŸi (g/L/gÃ¼n)', 'Maks. BiyokÃ¼tle YoÄŸunluÄŸu (g/L)'], datasets: [{ label: 'Dikey TÃ¼bÃ¼ler FBR', data: [1.65, 20.0], backgroundColor: '#118AB2' }, { label: 'DÃ¼z Panel FBR', data: [4.8, 26.6], backgroundColor: '#06D6A0' }, { label: 'AÃ§Ä±k Havuz', data: [0.3, 1.5], backgroundColor: '#FFD166' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'DeÄŸer' } } }, plugins: { title: { display: true, text: 'FarklÄ± FBR Teknolojilerinin Performans KarÅŸÄ±laÅŸtÄ±rmasÄ±' } } } });
            }
        
        });
    </script>
</body>
</html>

